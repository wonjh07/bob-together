# AI Changelog (Rolling)

## 2026-02-26
- Completed action test coverage baseline:
  - added missing test files:
    - `src/actions/appointment/[appointmentId]/get.test.ts`
    - `src/actions/appointment/search.test.ts`
    - `src/actions/group/getMyGroupsAction.test.ts`
    - `src/actions/group/listMyGroupsWithStatsAction.test.ts`
    - `src/actions/group/searchGroupsAction.test.ts`
    - `src/actions/group/searchGroupsWithCountAction.test.ts`
  - verified no uncovered server action remains (`ACTION_FILES 47 / MISSING 0`)
  - verified full action test run:
    - `npx jest src/actions --runInBand`
    - `47 passed, 47 total / 161 tests passed`
  - verified static checks:
    - `npm run type-check`
    - `npm run lint`
- Added invitation response regression tests for race-time business errors:
  - new test file `src/actions/invitation/respond.test.ts`
  - verifies explicit user-facing messages for:
    - `forbidden-appointment-ended`
    - `forbidden-appointment-canceled`
  - verifies successful accepted response mapping
- Simplified onboarding back button rendering:
  - removed layout-level gate component usage from `src/app/(onboarding)/layout.tsx`
  - rendered back button directly on `src/app/(onboarding)/signup/page.tsx`
  - deleted unused `src/components/BackButtonGate.tsx`
  - verified with `npm run type-check` and `npm run lint`
- Optimized local font assets for build/cache performance:
  - switched `next/font/local` source in `src/app/layout.tsx` from 7x `.woff` to 4x `.woff2` (400/500/600/700)
  - removed unused legacy `.woff` files under `src/fonts`
  - verified with `npm run type-check`, `npm run lint`, `npm run build`
- Updated appointment member-list access policy to group-membership scope:
  - `get_appointment_members_with_count` access check changed from `appointment_members` to `appointments.group_id + group_members`
  - non-appointment participants in the same group can now view appointment member list
  - added migration:
    - `supabase/migrations/20260226039000_allow_group_members_get_appointment_members_rpc.sql`
  - updated test:
    - `src/actions/appointment/[appointmentId]/members/get.test.ts`
- Completed remaining P1 profile sync error-contract:
  - added `metadata-sync-failed` to profile error domain
    - `src/actions/user/_shared.ts`
  - user/profile actions now return explicit partial-success error on auth metadata sync failure:
    - `src/actions/user/updateProfileAction.ts`
    - `src/actions/user/uploadProfileImageAction.ts`
    - `src/actions/user/deleteProfileImageAction.ts`
  - aligned tests:
    - `src/actions/user/updateProfileAction.test.ts`
    - `src/actions/user/uploadProfileImageAction.test.ts`
    - `src/actions/user/deleteProfileImageAction.test.ts`
- P1 error-contract hardening for group/create flows:
  - strengthened UUID validation in group actions:
    - `src/actions/group/joinGroupAction.ts`
    - `src/actions/group/leaveGroupAction.ts`
    - `src/actions/group/getGroupMembersAction.ts`
    - `src/actions/group/sendGroupInvitationAction.ts`
    - `src/actions/group/getGroupByIdAction.ts`
  - improved error mapping clarity:
    - `sendGroupInvitationAction`: `invalid-format` message now maps to generic format error (no longer self-invite-only wording)
    - `getGroupByIdAction`: DB error -> `server-error`, no-row -> `group-not-found`
  - removed brittle message-string dependency in appointment creation:
    - `src/actions/appointment/create.ts` now maps `P0001` directly to `missing-group` (without checking DB error message text)
  - added/updated tests:
    - `src/actions/group/joinGroupAction.test.ts`
    - `src/actions/group/leaveGroupAction.test.ts`
    - `src/actions/group/sendGroupInvitationAction.test.ts`
    - `src/actions/group/getGroupMembersAction.test.ts`
    - `src/actions/group/getGroupByIdAction.test.ts` (new)
    - `src/actions/appointment/create.test.ts`
- Hardened action error-contracts and runtime input validation (P0):
  - added explicit error codes:
    - `appointment-not-found` (appointment domain)
    - `profile-not-found` (profile image domain)
  - mapped RPC business errors to explicit codes in:
    - `src/actions/appointment/[appointmentId]/update.ts`
    - `src/actions/appointment/[appointmentId]/members/join.ts`
    - `src/actions/appointment/[appointmentId]/members/leave.ts`
    - `src/actions/appointment/[appointmentId]/members/invite.ts`
    - `src/actions/user/uploadProfileImageAction.ts`
    - `src/actions/user/deleteProfileImageAction.ts`
  - added runtime schema validation for cursor/limit inputs in:
    - `src/actions/appointment/list.ts`
    - `src/actions/appointment/search.ts`
    - `src/actions/group/listMyGroupsWithStatsAction.ts`
    - `src/actions/group/searchGroupsWithCountAction.ts`
  - fixed missing RPC `invalid-format` mapping in:
    - `src/actions/group/getGroupMembersAction.ts`
  - hardened place search exception handling:
    - `src/actions/place.ts` now returns typed `server-error` on `fetch/json` throw paths
  - added/updated tests:
    - `src/actions/user/uploadProfileImageAction.test.ts`
    - `src/actions/user/deleteProfileImageAction.test.ts`
    - `src/actions/appointment/[appointmentId]/members/join.test.ts`
    - `src/actions/appointment/[appointmentId]/members/leave.test.ts`
    - `src/actions/appointment/[appointmentId]/members/invite.test.ts`
    - `src/actions/appointment/list.test.ts`
    - `src/actions/group/getGroupMembersAction.test.ts`
    - `src/actions/place.test.ts`
- Standardized action result construction to common helpers in auth/user/validation actions:
  - switched manual `{ ok: ... }` returns to `actionError`/`actionSuccess`
  - updated actions:
    - `src/actions/user/getUserData.ts`
    - `src/actions/user/updateProfileAction.ts`
    - `src/actions/user/deleteProfileImageAction.ts`
    - `src/actions/user/uploadProfileImageAction.ts`
    - `src/actions/auth/loginAction.ts`
    - `src/actions/auth/signupAction.ts`
    - `src/actions/validation.ts`
  - updated test expectation:
    - `src/actions/user/deleteProfileImageAction.test.ts`
- Expanded action result helper standardization to remaining auth/group actions with manual `{ ok: ... }` returns:
  - switched manual returns to `actionError`/`actionSuccess` in:
    - `src/actions/auth/logoutAction.ts`
    - `src/actions/group/findGroupByNameAction.ts`
    - `src/actions/group/getGroupByIdAction.ts`
    - `src/actions/group/getMyGroupsAction.ts`
    - `src/actions/group/listMyGroupsWithStatsAction.ts`
    - `src/actions/group/searchGroupsAction.ts`
    - `src/actions/group/searchGroupsWithCountAction.ts`
    - `src/actions/group/searchUsersAction.ts`
    - `src/actions/group/getGroupMembersAction.ts`
    - `src/actions/group/leaveGroupAction.ts`
  - validated with focused Jest suites + `npm run type-check` + `npm run lint`
- Reduced `createAppointmentAction` DB calls to single RPC:
  - added migration `supabase/migrations/20260226038000_create_appointment_with_owner_member_default_group_rpc.sql`
  - moved fallback group resolution (`groupId` 미지정 시 최근 가입 그룹 선택) into `create_appointment_with_owner_member`
  - `createAppointmentAction` now calls only RPC + mapping (removed `group_members` pre-query)
  - updated test: `src/actions/appointment/create.test.ts`
- Migrated `deleteMyReviewAction` to single transactional RPC:
  - added migration `supabase/migrations/20260226037000_delete_my_review_transaction_rpc.sql`
  - action now calls `delete_my_review_transactional` and maps `error_code`
  - added test: `src/actions/appointment/review/delete.test.ts`
- Migrated `getAppointmentCommentsAction` to single RPC:
  - added migration `supabase/migrations/20260226036000_get_appointment_comments_with_cursor_rpc.sql`
  - action now calls `get_appointment_comments_with_cursor` and maps RPC payload
  - updated test: `src/actions/appointment/[appointmentId]/comments/list.test.ts`
- Migrated `getGroupMembersAction` to single RPC:
  - added migration `supabase/migrations/20260226035000_get_group_members_with_count_rpc.sql`
  - action now calls `get_group_members_with_count` and maps RPC payload
  - added test: `src/actions/group/getGroupMembersAction.test.ts`
- Migrated `getAppointmentMembersAction` to single RPC:
  - added migration `supabase/migrations/20260226034000_get_appointment_members_with_count_rpc.sql`
  - action now calls `get_appointment_members_with_count` and maps RPC payload
  - updated test: `src/actions/appointment/[appointmentId]/members/get.test.ts`
- Migrated `leaveAppointmentAction` to single transactional RPC:
  - added migration `supabase/migrations/20260226033000_leave_appointment_transaction_rpc.sql`
  - action now calls `leave_appointment_transactional` and maps `error_code`
  - updated test: `src/actions/appointment/[appointmentId]/members/leave.test.ts`
- Migrated `updateAppointmentStatusAction` to single transactional RPC:
  - added migration `supabase/migrations/20260226032000_update_appointment_status_transaction_rpc.sql`
  - action now calls `update_appointment_status_transactional` and maps `error_code`
  - updated test: `src/actions/appointment/[appointmentId]/updateStatus.test.ts`
- Migrated `leaveGroupAction` to single transactional RPC:
  - added migration `supabase/migrations/20260226031000_leave_group_transaction_rpc.sql`
  - action now calls `leave_group_transactional` and maps `error_code`
  - updated test: `src/actions/group/leaveGroupAction.test.ts`
- Transactionalized user profile-image DB writes via RPC (1 migration per action):
  - added migrations:
    - `supabase/migrations/20260226029000_clear_user_profile_image_transaction_rpc.sql`
    - `supabase/migrations/20260226030000_set_user_profile_image_transaction_rpc.sql`
  - switched actions from `users select/update` chains to single RPC calls:
    - `src/actions/user/deleteProfileImageAction.ts`
    - `src/actions/user/uploadProfileImageAction.ts`
  - updated tests for RPC mocking:
    - `src/actions/user/deleteProfileImageAction.test.ts`
    - `src/actions/user/uploadProfileImageAction.test.ts`
- Unified user action auth failures to common guard error:
  - migrated direct `auth.getUser()` checks to `requireUser()` in:
    - `src/actions/user/getUserData.ts`
    - `src/actions/user/updateProfileAction.ts`
    - `src/actions/user/deleteProfileImageAction.ts`
    - `src/actions/user/uploadProfileImageAction.ts`
  - auth failure response is now consistently `error: 'unauthorized'` with `로그인이 필요합니다.`
  - removed unused `user-not-found` from `AuthErrorCode` (`src/types/result.ts`)
  - updated related tests:
    - `src/actions/user/getUserData.test.ts`
    - `src/actions/user/updateProfileAction.test.ts`
    - `src/actions/user/deleteProfileImageAction.test.ts`
- Standardized group action auth checks to common guard:
  - migrated direct `supabase.auth.getUser()` checks to `requireUser()` in:
    - `src/actions/group/getMyGroupsAction.ts`
    - `src/actions/group/searchUsersAction.ts`
    - `src/actions/group/getGroupMembersAction.ts`
    - `src/actions/group/leaveGroupAction.ts`
    - `src/actions/group/searchGroupsWithCountAction.ts`
    - `src/actions/group/listMyGroupsWithStatsAction.ts`
  - kept existing unauthorized contract (`error: 'unauthorized'`, message) unchanged
- Introduced user-scoped React Query keys for auth-safe cache partitioning:
  - added query scope utilities/providers:
    - `src/libs/query/queryScope.ts`
    - `src/libs/query/getServerQueryScope.ts`
    - `src/provider/query-scope-provider.tsx`
  - wired initial scope from server session in root layout/provider:
    - `src/app/layout.tsx`
    - `src/app/providers.tsx`
  - extended query key factories and query option factories with optional `scope`
    across appointment/group/place/invitation domains
  - applied scoped query options to dashboard/profile/search/detail/create/invitation clients
    and SSR prefetch pages so hydration keys stay aligned
- Fixed refresh-time infinite list cache reset issue:
  - updated `src/app/providers.tsx` Supabase auth event handling
  - `queryClient.clear()` is no longer executed on initial session restoration
  - cache clear on `SIGNED_IN` now runs only when user account actually changes
  - `SIGNED_OUT` keeps full cache clear behavior
- Transactionalized multi-query group/member/review/update actions (3+ DB calls):
  - added migrations:
    - `supabase/migrations/20260226019000_join_group_transaction_rpc.sql`
    - `supabase/migrations/20260226020000_create_group_transaction_rpc.sql`
    - `supabase/migrations/20260226021000_send_group_invitation_transaction_rpc.sql`
    - `supabase/migrations/20260226022000_search_group_invitable_users_transaction_rpc.sql`
    - `supabase/migrations/20260226023000_search_appointment_invitable_users_transaction_rpc.sql`
    - `supabase/migrations/20260226024000_join_appointment_transaction_rpc.sql`
    - `supabase/migrations/20260226025000_get_appointment_invitation_state_transaction_rpc.sql`
    - `supabase/migrations/20260226026000_update_appointment_transaction_rpc.sql`
    - `supabase/migrations/20260226027000_get_appointment_review_target_transaction_rpc.sql`
    - `supabase/migrations/20260226028000_submit_place_review_transaction_rpc.sql`
  - switched actions to single RPC + mapping:
    - `src/actions/group/joinGroupAction.ts`
    - `src/actions/group/createGroupAction.ts`
    - `src/actions/group/sendGroupInvitationAction.ts`
    - `src/actions/group/searchGroupInvitableUsersAction.ts`
    - `src/actions/appointment/[appointmentId]/members/searchInvitees.ts`
    - `src/actions/appointment/[appointmentId]/members/join.ts`
    - `src/actions/appointment/[appointmentId]/members/getInvitationState.ts`
    - `src/actions/appointment/[appointmentId]/update.ts`
    - `src/actions/appointment/review/getTarget.ts`
    - `src/actions/appointment/review/submit.ts`
  - updated action tests for RPC mocking:
    - `src/actions/group/joinGroupAction.test.ts`
    - `src/actions/group/createGroupAction.test.ts`
    - `src/actions/group/sendGroupInvitationAction.test.ts`
    - `src/actions/group/searchGroupInvitableUsersAction.test.ts`
    - `src/actions/appointment/[appointmentId]/members/searchInvitees.test.ts`
- Transactionalized appointment invitation send flow:
  - added migration `supabase/migrations/20260226018000_send_appointment_invitation_transaction_rpc.sql`
  - added RPC `send_appointment_invitation_transactional` for invite validation + insert
  - `sendAppointmentInvitationAction` now calls RPC and maps business `error_code` to existing UX messages
  - updated tests in `src/actions/appointment/[appointmentId]/members/invite.test.ts`
- Optimized `받은 초대 목록` query path via RPC:
  - added migration `supabase/migrations/20260226017000_list_received_invitations_with_cursor_rpc.sql`
  - added RPC `list_received_invitations_with_cursor` (`created_time + invitation_id` keyset)
  - `listReceivedInvitationsAction` now calls RPC instead of action-side join + cursor `or(...)`
  - updated tests in `src/actions/invitation/listReceived.test.ts`
- Optimized `내 댓글` query path via RPC:
  - added migration `supabase/migrations/20260226016000_list_my_comments_with_cursor_rpc.sql`
  - added RPC `list_my_comments_with_cursor` (`created_at + comment_id` keyset)
  - `listMyCommentsAction` now calls RPC instead of action-side join + cursor `or(...)`
  - updated tests in `src/actions/appointment/comment/listMine.test.ts`
- Hardened appointment comment mutation error handling:
  - `create/update/delete` comment actions now distinguish DB error classes
  - permission/foreign-key errors (`42501`, `23503`) map to `forbidden`
  - unexpected DB errors map to `server-error` with structured server logs
  - added regression tests for all three comment mutations:
    - `src/actions/appointment/[appointmentId]/comments/create.test.ts`
    - `src/actions/appointment/[appointmentId]/comments/update.test.ts`
    - `src/actions/appointment/[appointmentId]/comments/delete.test.ts`
- Transactionalized invitation response flow:
  - added RPC migration `supabase/migrations/20260226015000_respond_invitation_transaction_rpc.sql`
  - new function `respond_to_invitation_transactional` atomically handles:
    - invitation pending-state lock/check
    - membership insert for accepted decision (group/appointment)
    - invitation status update (`accepted`/`rejected`)
  - `respondToInvitationAction` now calls the RPC and maps business error codes to existing UX messages
- Transactionalized appointment creation flow:
  - added RPC migration `supabase/migrations/20260226014000_create_appointment_with_owner_member_rpc.sql`
  - new function `create_appointment_with_owner_member` atomically executes:
    - place upsert (`kakao_id` conflict update)
    - appointment insert
    - owner membership insert
  - `createAppointmentAction` now calls the RPC instead of running 3 separate writes
- Added comment-list keyset support index for appointment detail:
  - new migration `supabase/migrations/20260226013000_add_appointment_comments_appointment_index.sql`
  - adds partial index `appointment_comments_appointment_created_id_active_idx`
    on `(appointment_id, created_at desc, comment_id desc)` for active comments
- Optimized appointment comments pagination query cost:
  - `getAppointmentCommentsAction` now requests `count: 'exact'` only on first page (`cursor` 없는 요청)
  - cursor pages skip exact count and return `commentCount: 0` to avoid repeated full count scans on every `fetchNextPage`
  - updated tests in `src/actions/appointment/[appointmentId]/comments/list.test.ts`
- Restored wheel-to-horizontal scroll behavior on profile review cards:
  - fixed `ReviewsWaitList` wheel-listener effect dependency so listener is attached after list mount (post-loading)
  - changed effect deps from `[]` to `[items.length]`
  - file: `src/app/dashboard/(nav)/profile/_components/ReviewsWaitList.tsx`
- Fixed local font preload warning on profile page:
  - set `preload: false` on root `localFont` config to stop eager preload of all Pretendard weights on initial load
  - file: `src/app/layout.tsx`
- Reduced noisy preload warnings on reviewable-review cards:
  - set `prefetch={false}` on review card navigation links to avoid eager route preloads that are not used immediately
  - affected files:
    - `src/app/dashboard/(nav)/profile/_components/ReviewsWaitList.tsx`
    - `src/app/dashboard/(plain)/profile/reviews/waitlist/ProfileReviewWaitListClient.tsx`

## 2026-02-25
- Fixed passive wheel listener warning in profile review wait-list:
  - replaced React `onWheel` + `preventDefault()` with native `wheel` event listener registered as `{ passive: false }`
  - removed console warning: `Unable to preventDefault inside passive event listener invocation.`
  - file: `src/app/dashboard/(nav)/profile/_components/ReviewsWaitList.tsx`
- Fixed cursor datetime validation for keyset pagination:
  - changed cursor datetime schemas from `z.string().datetime(...)` to `z.string().datetime({ offset: true, ... })`
  - prevents false `invalid-format` errors when DB returns ISO strings with timezone offsets (e.g. `+00:00`)
  - affected actions: reviewable reviews, my reviews, history, my comments, appointment comments, invitation list, place reviews
- Stabilized React Query default behavior for less jittery refresh:
  - updated `src/libs/query/clientQueryClient.ts` defaults
  - `staleTime`: 60s -> 30s, `gcTime`: 5m -> 15m
  - disabled focus-triggered refetch (`refetchOnWindowFocus: false`)
  - enabled reconnect/mount refetch (`refetchOnReconnect: true`, `refetchOnMount: true`)
  - disabled automatic retries for queries/mutations (`retry: 0`)
- Optimized appointment-detail comments loading:
  - switched `getAppointmentCommentsAction` to keyset pagination (`created_at + comment_id`) with `limit + 1`
  - fixed total comment count accuracy by using `count: 'exact'` on the comments query (removed planned/fallback estimate path)
  - changed comments query to `useInfiniteQuery` and added `이전 댓글 더보기` in `AppointmentCommentsSection`
  - reduced first-load payload by removing comments prefetch from appointment detail server page
  - updated tests: `src/actions/appointment/[appointmentId]/comments/list.test.ts`
- Hardened auth session cache lifecycle in app provider:
  - added Supabase auth state subscription in `src/app/providers.tsx`
  - on `SIGNED_IN` / `SIGNED_OUT`, React Query cache is globally cleared (`queryClient.clear()`)
  - prevents stale cross-account query data when auth state changes outside specific login/logout screens
- Optimized profile appointment history query path:
  - added RPC migration `supabase/migrations/20260225213000_list_appointment_history_with_stats_rpc.sql`
  - switched `listAppointmentHistoryAction` to single RPC call (`list_appointment_history_with_stats`)
  - removed action-side multi-query aggregation (`appointments` + `appointment_members` + `user_review`)
  - added tests `src/actions/appointment/history/list.test.ts` for rpc-error/empty/pagination mapping cases
- Optimized place-detail query path:
  - added RPC migration `supabase/migrations/20260225223000_get_place_detail_with_stats_rpc.sql`
  - switched `getPlaceDetailAction` to single RPC call (`get_place_detail_with_stats`)
  - removed action-side review score row fetch + JS aggregation
  - added tests in `src/actions/place.test.ts` for invalid-id/rpc-error/mapping-rounding cases
- Optimized invitation search query footprint:
  - group invite search now fetches candidate users first, then resolves existing-member/pending state only for candidate user IDs (`in(...)`), instead of scanning whole group members/pending invites on each input
  - appointment invite search now checks existing appointment members only for candidate user IDs (`in(...)`), instead of reading full appointment member set on each input
  - updated tests:
    - `src/actions/group/searchGroupInvitableUsersAction.test.ts`
    - `src/actions/appointment/[appointmentId]/members/searchInvitees.test.ts`
- Optimized notification invitation list pagination:
  - switched `listReceivedInvitationsAction` from offset cursor to keyset cursor (`created_time + invitation_id`)
  - replaced `range(offset, offset + limit)` with `limit(limit + 1)` + keyset `or(...)` filter
  - updated cursor type in `src/actions/invitation/types.ts`
  - added tests: `src/actions/invitation/listReceived.test.ts`
- Optimized `내 댓글` list pagination:
  - switched `listMyCommentsAction` from offset cursor to keyset cursor (`created_at + comment_id`)
  - replaced `range(offset, offset + limit)` with `limit(limit + 1)` + keyset `or(...)` filter
  - updated `MyCommentCursor` in `src/actions/appointment/types.ts`
  - updated tests: `src/actions/appointment/comment/listMine.test.ts`
- Optimized place reviews pagination:
  - switched `listPlaceReviewsAction` from action-side `offset` query to RPC-based keyset pagination (`updated_at + review_id`)
  - added migration `supabase/migrations/20260225235900_list_place_reviews_with_cursor_rpc.sql`
  - `listPlaceReviewsAction` now calls `list_place_reviews_with_cursor` and maps `nextCursor` as `{ updatedAt, reviewId }`
  - updated tests in `src/actions/place.test.ts` for cursor validation, rpc error, and keyset cursor mapping
- Optimized `내 리뷰` list pagination:
  - switched `listMyReviewsAction` from action-side `offset` query to RPC-based keyset pagination (`updated_at + review_id`)
  - added migration `supabase/migrations/20260226001000_list_my_reviews_with_cursor_rpc.sql`
  - `MyReviewCursor` changed to `{ updatedAt, reviewId }` in `src/actions/appointment/types.ts`
  - added tests in `src/actions/appointment/review/listMine.test.ts` for cursor validation, rpc error, and keyset cursor mapping
- Optimized `리뷰 가능한 약속` list pagination:
  - switched `listReviewableAppointmentsAction` from offset-based RPC to keyset RPC (`ends_at + appointment_id`)
  - added migration `supabase/migrations/20260226004000_list_reviewable_appointments_with_stats_cursor_rpc.sql`
  - `ReviewableAppointmentsCursor` changed to `{ endsAt, appointmentId }` in `src/actions/appointment/types.ts`
  - added tests in `src/actions/appointment/review/list.test.ts` for cursor validation, rpc error, and keyset cursor mapping
- Stabilized dashboard appointment list pagination cursor:
  - switched dashboard list action from single cursor (`start_at`) to composite keyset cursor (`start_at + appointment_id`)
  - added migration `supabase/migrations/20260226005000_list_appointments_with_stats_cursor_rpc.sql`
  - updated `ListAppointmentsParams/ListAppointmentsResult` cursor shape in `src/actions/appointment/types.ts`
  - updated query pageParam typing in `src/libs/query/appointmentQueries.ts` and `src/app/dashboard/_components/AppointmentList.tsx`
  - added tests in `src/actions/appointment/list.test.ts`
- Stabilized profile history pagination cursor:
  - switched `listAppointmentHistoryAction` from offset cursor to composite keyset cursor (`ends_at + appointment_id`)
  - added migration `supabase/migrations/20260226005500_list_appointment_history_with_stats_cursor_rpc.sql`
  - updated `AppointmentHistoryCursor` shape and history action/tests
- Added keyset pagination support indexes:
  - added migration `supabase/migrations/20260226012000_add_keyset_pagination_indexes.sql`
  - includes composite/partial indexes for:
    - appointments (`group_id + start_at + appointment_id`, `pending ends_at + appointment_id`)
    - appointment_members (`user_id + appointment_id`)
    - appointment_comments (active rows by `user_id + created_at + comment_id`)
    - invitations (active received rows by `invitee_id + created_time + invitation_id`)
    - user_review (`place_id + updated_at + review_id`, `user_id + updated_at + review_id`)
- Hardened account-switch cache isolation:
  - clear React Query cache on logout in `ProfileDrop` before `logoutAction()`
  - clear React Query cache on login success in `LoginForm` before redirect
  - prevents previous-account history/query data from flashing after account switch
- Fixed place-detail back navigation fallback:
  - `PlaceDetailClient` now uses explicit `onBack={() => router.back()}` for `PlainTopNav`
  - prevents navigation to non-existent `/dashboard/places` parent route.
- Reverted group-manage filter row wrapping behavior:
  - `ProfileGroups` filter box now stays single-line (`nowrap`)
  - action buttons are always right-aligned without responsive line wrap.
- Updated profile `작성 가능한 리뷰` card row UX:
  - removed the bottom inline `더 불러오는 중...` loader from `ReviewsWaitList`
  - infinite loading remains sentinel-based without extra bottom text.
- Improved appointment-create date/time input UX:
  - date/time inputs in `DateTimeStep` now open native pickers when clicking anywhere on the input field (not only the browser icon) via safe `showPicker()` invocation.
- Unified appointment-create step progression into `PlainTopNav` right action:
  - `MultiStepFormClient` now owns per-step validation + next-transition logic via `handleNavNext`
  - removed per-step `NextButton` dependency from `GroupStep`/`TitleStep`/`DateTimeStep`/`PlaceStep`
  - deleted now-unused `src/app/dashboard/(plain)/appointments/create/_components/ui/NextButton.*`
- Fixed `PlainTopNav` center title visibility regression:
  - replaced brittle title width clamp (`calc(100% - 160px)`) with safe center constraints (`minWidth: 0`, `maxWidth: 100%`, horizontal padding)
  - keeps centered title + edge-aligned side actions without hiding title text.
- Improved `PlainTopNav` layout stability:
  - switched nav layout to 3-column grid (`1fr auto 1fr`) to keep title visually centered
  - left/right controls are pinned to edges (`start/end`) while title remains centered
  - right action button now prevents wrapping (`white-space: nowrap`) so 3+ character labels do not break into multiple lines.
- Added explicit empty-result feedback for invitation member search:
  - group member invitation (`/dashboard/profile/groups/[groupId]/members/invitation`)
  - appointment invitation (`/dashboard/appointments/invitation`)
  - both now render `검색 결과가 없습니다.` after a completed search with zero results.
- Unified search input row across service screens with a shared UI component:
  - added `src/components/ui/SearchInput.tsx` (+ `SearchInput.css.ts`)
  - migrated search input usage in dashboard search, group find, group member invitation, appointment invitation, appointment create place step, and appointment edit-place page
  - removed legacy local search component under `src/app/dashboard/(nav)/search/_components/ui/SearchInput.*`
- Updated group-manage chip-filter actions to icon buttons:
  - `그룹 찾기` -> search icon (`SearchIcon`)
  - `새 그룹` -> group-add icon (`AiOutlineUsergroupAdd`)
  - adjusted `src/app/dashboard/(plain)/profile/groups/page.css.ts` button sizing to icon-only circular actions (`36x36`) to reduce text-wrap/overflow styling breaks.
- Reduced low-value shared styling abstractions:
  - removed `src/components/ui/IconStackLabel.tsx` (+ css) and replaced bottom-nav usage with local markup/styles
  - removed alias-only `src/app/dashboard/_components/TypeFilter.css.ts` and switched `TypeFilter` to direct chip primitive usage
- Updated style guide to discourage class composition/inheritance for feature/page CSS:
  - added explicit rules in `ai_docs/STYLE_GUIDE.md` to prefer deterministic local classes
  - clarified exception scope: composition is allowed only for stable shared primitives
- Fixed intermittent profile/group UI style drift:
  - `ProfileQuickLinks` now renders local icon+label markup (no `IconStackLabel` dependency) with explicit icon sizes for deterministic rendering
  - group-manage filter row now wraps responsively on narrow widths to prevent chip/action overflow clipping
  - plain dashboard layout overflow changed from full `scroll` to `overflow-y: auto` + `overflow-x: hidden` to block accidental horizontal scroll
- Added group invitation search scope hardening:
  - new action `searchGroupInvitableUsersAction` in `src/actions/group/searchGroupInvitableUsersAction.ts`
  - group member invitation page now uses group-scoped invitee search instead of global `searchUsersAction`
  - search results now exclude existing group members but include pending invitees (UI marks `초대 완료`)
  - added tests `src/actions/group/searchGroupInvitableUsersAction.test.ts`
- Added appointment invitation search scope hardening:
  - new action `searchAppointmentInvitableUsersAction` in `src/actions/appointment/[appointmentId]/members/searchInvitees.ts`
  - invitation page now uses appointment-scoped invitee search instead of global `searchUsersAction`
  - search results now exclude existing appointment members but include pending invitees (UI marks `초대 완료`)
  - added tests `src/actions/appointment/[appointmentId]/members/searchInvitees.test.ts`
- Removed legacy onboarding join redirect pages again:
  - deleted `src/app/(onboarding)/group/join/page.tsx`
  - deleted `src/app/(onboarding)/group/join/confirm/page.tsx`
  - deleted `src/app/(onboarding)/group/join/complete/page.tsx`
- Removed remaining legacy onboarding join route references in `src/components/BackButtonGate.tsx`.
- Updated `ai_docs/FLOWS.md` route map to remove legacy join route entries.
- Login flow now respects middleware redirect intent:
  - added safe redirect resolver `src/app/(onboarding)/login/redirect.ts`
  - `LoginForm` now uses `useSearchParams` + `router.replace(resolveLoginRedirectPath(...))`
  - added unit test `src/app/(onboarding)/login/redirect.test.ts`
- Hardened appointment invitation rule at server-action level:
  - `sendAppointmentInvitationAction` now blocks invites for `canceled` appointments
  - `sendAppointmentInvitationAction` now blocks invites for time-ended appointments
  - added action tests `src/actions/appointment/[appointmentId]/members/invite.test.ts`
- Added `ai_docs/E2E_SCENARIOS.md` as the current baseline E2E reference:
  - onboarding/auth -> group -> invitation -> appointment -> notifications -> review user journeys
  - risk list with prioritized fix plan (P0~P2) for business logic + UX gaps
  - QA checklist for post-fix verification
- Registered the new doc in `ai_docs/INDEX.md`.
- Added group-manage tab filtering UI in `src/app/dashboard/(plain)/profile/groups/ProfileGroupsClient.tsx` to split the list into:
  - `내가 만든 그룹` (`isOwner === true`)
  - `가입한 그룹` (`isOwner === false`)
- Reused shared chip toggle pattern (`ChipToggleGroup` + chip primitives) to match dashboard filter interaction.
- Updated group-manage page styles (`src/app/dashboard/(plain)/profile/groups/page.css.ts`) to include a tab filter area under `PlainTopNav` while keeping existing plain list page primitives.
- Improved empty-state handling by tab so each view shows its own message when no groups match the selected tab.
- Updated group-manage card overflow menu behavior by ownership:
  - owner cards now show `멤버 관리`
  - joined-member cards keep `그룹 탈퇴`
- Added group member list page route `src/app/dashboard/(plain)/profile/groups/[groupId]/members/page.tsx`:
  - PlainTopNav title `그룹 멤버`
  - same structure/style as appointment member list (caption + member cards + placeholder more button)
- Added `getGroupMembersAction` with membership access check and exported related result/item types.
- Added group member invitation flow:
  - `그룹 멤버` 상단 우측 `멤버 초대` 버튼으로 이동
  - new route `src/app/dashboard/(plain)/profile/groups/[groupId]/members/invitation/page.tsx`
  - search + invite UI/client for group invitations using `searchUsersAction` and `sendGroupInvitationAction`
  - invite result states reflected as `그룹 멤버` / `초대 완료` / `전송 중`
- Extended `PlainTopNav` with optional `backHref` and `rightHref` props so server-rendered pages can configure navigation actions without client wrapper callbacks.
- Added `그룹 관리` 상단 필터 영역 우측 `새 그룹` 버튼 and connected it to new create route:
  - `src/app/dashboard/(plain)/profile/groups/create/page.tsx`
  - `src/app/dashboard/(plain)/profile/groups/create/GroupCreateClient.tsx`
- Group create now supports immediate flow to group members page after success:
  - create success invalidates group membership queries,
  - then navigates to `/dashboard/profile/groups/[groupId]/members`.
- Consolidated onboarding group create/invitation pages into dashboard profile routes:
  - `/group/create`, `/group/create/complete`, `/group/invitation`, `/group/invitation/complete` now redirect to dashboard group create/manage/invitation flows.
  - removed old onboarding-only create/invitation client implementations and related css files.
- Added `그룹 관리` 상단 우측 `그룹 찾기` 버튼 and new group find page:
  - `src/app/dashboard/(plain)/profile/groups/find/page.tsx`
  - `src/app/dashboard/(plain)/profile/groups/find/GroupFindClient.tsx`
  - `src/app/dashboard/(plain)/profile/groups/find/page.css.ts`
- Group find page supports group search + join flow (`searchGroupsWithCountAction`, `joinGroupAction`) and reflects join state in-place (`가입 완료`).
- Consolidated onboarding group join flow into dashboard group find/manage:
  - `/group/join` and `/group/join/confirm` redirect to `/dashboard/profile/groups/find`
  - `/group/join/complete` redirects to `/dashboard/profile/groups`
  - removed old onboarding-only join client/confirm/complete UI files and related css files.
- Updated onboarding group entry page `그룹 가입하기` button to navigate directly to `/dashboard/profile/groups/find`.
- Removed now-unnecessary onboarding redirect pages for group create/invitation/join flows:
  - deleted `src/app/(onboarding)/group/{create,invitation,join}/**/page.tsx` redirect stubs
  - onboarding group entry (`/group`) now serves as the only onboarding entry and links directly to dashboard group pages.
- Removed dashboard-side dependency on onboarding group style module:
  - replaced `@/app/(onboarding)/group/shared.css` button-class imports in
    - `src/app/dashboard/(plain)/appointments/invitation/AppointmentInvitationClient.tsx`
    - `src/app/dashboard/(plain)/profile/groups/[groupId]/members/invitation/GroupMemberInvitationClient.tsx`
  - by in-place page styles (`searchButton`) within each page css.
- Updated `ai_docs/FLOWS.md` Group Flow routes to match current code (onboarding entry + dashboard group domain routes only).

## 2026-02-24
- Added dropdown style primitives `src/styles/primitives/dropdown.css.ts` and chip style primitives `src/styles/primitives/chip.css.ts` to standardize menu/chip visual tokens (radius, border, hover, item spacing, disabled tones).
- Refactored dropdown-family styles to compose the new dropdown primitives:
  - `src/app/dashboard/_components/PeriodFilter.css.ts`
  - `src/app/dashboard/_components/GroupsDropdown.css.ts`
  - `src/components/ui/OverflowMenu.css.ts`
  - `src/app/dashboard/_components/nav/ui/ProfileDrop.css.ts`
- Updated `GroupsDropdown` trigger UI to use shared chevron pattern (open-state color + rotate transition).
- Refactored `src/app/dashboard/_components/TypeFilter.css.ts` to compose shared chip primitives.
- Updated `src/components/ui/ChipToggleGroup.tsx` to apply shared chip base styles by default while preserving per-screen overrides.
- Fixed dashboard period filter dropdown horizontal overflow by right-aligning the menu to the trigger in `src/app/dashboard/_components/PeriodFilter.css.ts`.
- Fixed appointment invite accept flow to prevent misleading `약속 정보를 찾을 수 없습니다.` errors:
  - Added group-membership precheck in `respondToInvitationAction` before appointment lookup.
  - Added invitee group-membership validation in `sendAppointmentInvitationAction` to block invalid appointment invites at creation time.
- Removed mouse drag-based horizontal scroll interaction from profile `ReviewsWaitList`; the section now uses native horizontal scrolling only.
- Improved `ReviewsWaitList` horizontal UX:
  - mobile touch horizontal scroll is enabled (`touchAction` adjusted),
  - mouse wheel in card row now scrolls horizontally by mapping `deltaY` to `scrollLeft`.
- Updated profile home `작성 가능한 리뷰` cards to show place name as the primary title instead of appointment title.
- Added optional place navigation support to `AppointmentPlaceMeta` (`placeHref`) and wired place-name links from appointment detail/edit, profile history, and review editor cards.
- Added place detail flow:
  - new route `/dashboard/places/[placeId]` with `PlainTopNav`
  - place summary (name/address/rating meta) + read-only Kakao map
  - infinite-scroll review list UI via `listPlaceReviewsAction`
  - new place query modules `src/libs/query/placeKeys.ts`, `src/libs/query/placeQueries.ts`
- Added `react-icons` dependency and replaced local custom SVG icon implementations in `src/components/icons/*.tsx` with wrapper components based on Ant Design outline icons (`react-icons/ai`), preserving existing component names/usages.
- Added `StarIcon` (`src/components/icons/StarIcon.tsx`) and applied it to all rating star renderers (`PlaceRatingMeta`, `StarRatingDisplay`, `StarRatingInput`) to remove hardcoded `★` glyph usage.
- Replaced dashboard top-nav profile avatar trigger with a hamburger-menu trigger:
  - added `src/components/icons/MenuIcon.tsx`
  - updated `TopNavigation` + `ProfileDrop` to render menu icon button while keeping dropdown/logout behavior unchanged
- Replaced dashboard bottom-nav emoji icons with `react-icons` (`AiOutlineHome`, `AiOutlineCalendar`, `AiOutlinePlusCircle`, `AiOutlineSearch`, `AiOutlineUser`) in `src/app/dashboard/_components/nav/BottomNavigation.tsx`.
- Fixed `GroupIcon` size regression after react-icons migration: when `width/height` props are passed, the icon now resolves size from those values instead of always using the onboarding default size.
- Replaced `OverflowMenu` trigger text glyph (`⋮`) with `react-icons` `BsThreeDotsVertical` in `src/components/ui/OverflowMenu.tsx`.
- Added reusable loading spinner atom `src/components/ui/LoadingSpinner.tsx` (+ `LoadingSpinner.css.ts`) and applied it to dashboard appointment list initial/infinite loading states.
- Extended `ListStateView` with `loadingVariant` (`text` | `spinner`) and applied spinner-based loading to notifications, search results, place reviews, and profile plain list pages (groups/history/reviews/comments/review-waitlist).
- Added reusable inline pagination loader `src/components/ui/InlineLoading.tsx` (+ `InlineLoading.css.ts`) and replaced plain `더 불러오는 중...` text blocks with `spinner + text` across dashboard/profile/search/place infinite lists.
- Fixed appointment-detail comment mutation invalidation gap by adding `invalidateMyCommentsQueries` in `AppointmentCommentsSection` create/update/delete paths, so `프로필 > 내 댓글` reflects latest data immediately after comment CRUD.
- Expanded cache invalidation coverage for stale cross-screen data:
  - added appointment `search` invalidation in detail `join/leave` actions,
  - added appointment list/search invalidation after appointment create success,
  - added place detail/reviews invalidation after review submit/delete,
  - added group manage/search-root cross invalidation after group join/leave.
- Refined notification invitation response invalidation:
  - `rejected` responses now invalidate only invitation list cache,
  - `accepted + group` now invalidates both `groupKeys.all` and `appointmentKeys.all` (membership changes can affect appointment visibility/search scope),
  - `accepted + appointment` keeps appointment-domain invalidation.
- Improved query handling/readability in profile review waitlist + hooks:
  - switched `/dashboard/profile/reviews/waitlist` from history-query + client filtering to `createReviewableAppointmentsQueryOptions`,
  - removed empty-result auto-fetch loop in waitlist client,
  - removed unused custom `useInfiniteQuery` implementation from `useInfiniteScroll.ts` to avoid TanStack API naming confusion.
- Removed duplicate review invalidation in review editor (`myReviewsRoot` direct invalidate), keeping helper-based invalidation only.
- Added query invalidation plan helpers and applied them across mutation clients:
  - `invalidateAppointmentCollectionQueries`, `invalidateAppointmentDetailAndCollectionQueries`,
    `invalidateReviewMutationQueries`, `invalidateMyCommentMutationQueries`
  - `invalidateGroupMembershipQueries`
  - `invalidateAfterInvitationResponse`
  - refactored detail/edit/create/comments/review/groups/notifications clients to use helper plans instead of ad-hoc invalidate lists.
- Updated `ai_docs/CACHE_OWNERSHIP.md` with helper-first mapping:
  - documented invalidate helper catalog (code 1:1),
  - rewrote mutation matrix to `user action -> server action -> UI caller -> helper`,
  - added explicit exception note for detail comments local patch strategy.

## 2026-02-23
- Converted review ownership model in app code from place-based to appointment-based (`appointment_id` 중심) across review/history/profile flows.
- Added migration `20260223220000_review_domain_to_appointment.sql`:
  - table rename `user_places -> user_review`
  - `appointment_id` column/fk + partial unique index `(user_id, appointment_id)`
  - legacy backfill (latest ended participated appointment)
  - appointment-based RLS policies
  - `get_appointment_detail_with_count` review aggregation source migration
  - new RPC `list_reviewable_appointments_with_stats`
- Updated review actions:
  - `listReviewableAppointmentsAction` now cursor-paginates via RPC and hides already-reviewed appointments by appointment scope
  - `submitPlaceReviewAction` upserts by `(user_id, appointment_id)`
  - `deleteMyReviewAction` now deletes by `appointmentId`
  - `listMyReviewsAction` now returns appointment-scoped review items
  - `getAppointmentReviewTargetAction` reads my review by appointment and keeps place-wide aggregate
- Updated history `canWriteReview` semantics from place-based to appointment-based.
- Added reviewable query key/options (`appointmentKeys.reviewable*`, `createReviewableAppointmentsQueryOptions`) and invalidation helper (`invalidateReviewableAppointmentsQueries`).
- Rebuilt profile review-wait section as a client component with:
  - horizontal infinite loading
  - hidden reviewed cards
  - pointer-drag horizontal scroll UX with click-guard
  - new hook `useHorizontalDragScroll`
- Added review-waitlist full page route `/dashboard/profile/reviews/waitlist`.
- Wired profile `작성 가능한 리뷰 > 전체보기` to the new waitlist route.
- Implemented waitlist page with same visual/card system as profile history (`PlainTopNav` + `HistoryAppointmentCard`) and infinite scroll.
- Added shared plain-list page style primitives (`src/styles/primitives/plainListPage.css.ts`) and applied them to profile plain pages (groups/history/reviews/waitlist/comments).
- Added shared plain-card typography/layout primitives (`src/styles/primitives/plainCard.css.ts`) and applied them to history/my-review/my-comment cards for consistent sizing/spacing.
- Added shared action button primitives (`src/styles/primitives/actionButton.css.ts`) and applied them to history/review CTA and notification invite action buttons.
- Added shared badge/text primitives (`src/styles/primitives/badge.css.ts`) and applied them to appointment status/참여 태그 and `me` label styles across dashboard/profile plain views.
- Added shared feedback primitives (`src/styles/primitives/feedback.css.ts`) for centered status/inline/error/empty text and applied them to notifications/review-editor/appointment detail(+members/edit)/comments empty states.
- Extended feedback primitives with `feedbackPanelText` and applied it to notification invite response/ended status labels.
- Moved notification invite status color tones into shared badge primitives (`badgeToneAccepted`, `badgeToneMuted`) and reused them across response/ended labels.
- Added common display formatting utilities:
  - `src/utils/dateFormat.ts` (`formatDateDot`, `formatDateKoreanWithWeekday`, `formatTime24`, `formatTimeRange24`, `formatTimeRangeKoreanMeridiem`, `formatRelativeKorean`)
  - `src/utils/address.ts` (`extractDistrict`)
- Replaced duplicated local formatter functions across dashboard/profile/notifications/appointment components with shared utilities.
- Added reusable UI components:
  - `src/components/ui/DateTimeMetaRow.tsx` (+ css)
  - `src/components/ui/PlaceRatingMeta.tsx` (+ css)
- Replaced duplicated date/time icon rows and place rating/meta rows in search/review-wait/detail/edit/history/review-editor/dashboard card screens with the shared components.
- Replaced profile review-waitlist score row rendering with shared `PlaceRatingMeta` to unify star/score typography with other appointment cards.
- Added `src/components/ui/UserIdentityInline.tsx` (+ css) for `avatar + name(+me) (+subtitle)` pattern.
- Replaced duplicated identity rows in group manage, appointment members, appointment detail author, profile history author, notification inviter, and search cards with `UserIdentityInline`.
- Added `src/components/ui/IconLabel.tsx` (+ css) for repeated `icon + text` inline meta rows.
- Replaced duplicated icon-label rows in notification invite message, my-comment title row, group manage member count, and search member-count meta with `IconLabel`.
- Expanded `IconLabel` usage to dashboard appointment card stats(인원/댓글), appointment detail member summary, and appointment-members caption count.
- Added `src/components/ui/IconStackLabel.tsx` (+ css) for repeated vertical `icon + label` quick-action items.
- Migrated profile quick-link grid items(그룹/지난 약속/리뷰/댓글) to `IconStackLabel`.
- Migrated dashboard bottom navigation item layout to `IconStackLabel` for consistent vertical icon/label structure.
- Refactored `src/components/ui/Buttons.*` to compose shared `actionButton` primitives and added optional `icon/className` slots to `LoginButton`/`SubmitButton`.
- Added `vars.color.muted` token and replaced remaining hardcoded muted/disabled gray values in review editor, my-review card, review-waitlist meta text, and `actionButtonMuted`.
- Expanded `ai_docs/STYLE_GUIDE.md` with shared UI primitive usage rules (`IconLabel`, `IconStackLabel`, `UserIdentityInline`, `DateTimeMetaRow`, `PlaceRatingMeta`, `AppointmentPlaceMeta`, `OverflowMenu`) and button/token reuse policies.
- Improved `submitPlaceReviewAction` error handling: DB save/load failures now log PostgREST metadata and return code-aware user messages for `42501/23503/23505`.
- Added migration `20260223234000_user_review_pk_to_review_id.sql` to replace legacy `user_places_pkey(user_id, place_id)` with `user_review_pkey(review_id)` and keep appointment-based unique rule `(user_id, appointment_id)`.
- Normalized import ordering in appointment detail/edit clients after shared component integration (lint clean).
- Added reusable `OverflowMenu` atom (`src/components/ui/OverflowMenu.tsx`) and migrated my-comment card menu to it.
- Migrated profile `내 리뷰`, `그룹 관리`, and appointment detail comment-card menus to shared `OverflowMenu` (outside-click close + unified menu styling/behavior).
- Normalized my-comment card typography sizing to match profile/review/history card scale.
- Added shared star-rating atoms:
  - `src/components/ui/StarRatingDisplay.tsx` (read-only stars)
  - `src/components/ui/StarRatingInput.tsx` (interactive stars)
- Migrated duplicated review star render logic in:
  - `src/app/dashboard/(plain)/profile/reviews/_components/MyReviewCard.tsx`
  - `src/app/dashboard/(plain)/profile/reviews/[appointmentId]/ReviewEditorClient.tsx`
- Added `src/hooks/useInfiniteLoadMore.ts` to standardize `fetchNextPage + hasNextPage + isFetchingNextPage + useInfiniteScroll` wiring.
- Applied `useInfiniteLoadMore` to repeated infinite-list screens:
  - dashboard appointment list
  - notifications
  - profile groups/history/reviews/comments/review-waitlist
  - search appointment/group results
- Added `src/components/ui/ListStateView.tsx` for common loading/error/empty rendering with consistent error fallback handling.
- Migrated repeated state blocks (`statusBox` / `status`) to `ListStateView` in notifications, profile plain lists, and search result lists.
- Added `src/hooks/useClickOutside.ts` to centralize outside-click close behavior.
- Replaced duplicated document-event outside-click logic in:
  - `src/components/ui/OverflowMenu.tsx`
  - `src/app/dashboard/_components/GroupsDropdown.tsx`
  - `src/app/dashboard/_components/PeriodFilter.tsx`
  - `src/app/dashboard/_components/nav/ui/ProfileDrop.tsx`
- Removed appointment plain-route `Appointment*TopNav` wrapper components and switched to direct `PlainTopNav` usage in:
  - appointment detail client
  - appointment edit page/client
  - appointment members page
  - appointment edit-place client
  - appointment invitation client/page
- Added `src/components/ui/DropdownMenu.tsx` and migrated:
  - `src/app/dashboard/_components/GroupsDropdown.tsx`
  - `src/app/dashboard/_components/PeriodFilter.tsx`
  to share the same dropdown open/close shell and outside-click behavior.
- Added `src/components/ui/ChipToggleGroup.tsx` for reusable chip-style toggle groups and migrated `src/app/dashboard/_components/TypeFilter.tsx`.
- Migrated `src/components/ui/OverflowMenu.tsx` to use `DropdownMenu` as the common dropdown shell.
- Migrated dashboard profile menu (`src/app/dashboard/_components/nav/ui/ProfileDrop.tsx`) to `DropdownMenu` and moved trigger ownership into `ProfileDrop`.
- Simplified `src/app/dashboard/_components/nav/TopNavigation.tsx` by removing local profile-dropdown open state and rendering `ProfileDropdown` trigger directly.

## 2026-02-20
- Added dashboard TopNav notification bell button linking to `/dashboard/notifications`.
- Added notifications page (`/dashboard/notifications`) with `PlainTopNav` and infinite-scroll invitation list UI.
- Added invitation card UI for both appointment/group invite types with `수락하기` / `거절하기` actions.
- Updated notifications appointment-invite card behavior: if invited appointment is already ended, hide action buttons and show `종료된 약속입니다`.
- Updated notifications list behavior to keep responded invites (`accepted`/`rejected`) in the list and render state labels (`초대 수락`/`초대 거절`) instead of action buttons.
- Updated notifications appointment invite card to link icon/title message row to appointment detail page.
- Added invitation action domain: `listReceivedInvitationsAction`, `respondToInvitationAction`.
- Added invitation React Query modules: `invitationKeys`, `createReceivedInvitationsQueryOptions`, `invalidateReceivedInvitationsQueries`.
- Added migration `20260220120000_invitations_invitee_select_update_policy.sql` to allow invitee self-select/update on `invitations`.

## 2026-02-15
- Added profile history page (`/dashboard/profile/history`) with `PlainTopNav` and infinite-scroll card list UI.
- Added `listAppointmentHistoryAction` to fetch ended appointments where current user is owner/member, ordered by latest ended time.
- Added history query key/options (`appointmentKeys.history`, `createAppointmentHistoryQueryOptions`) and wired TanStack infinite query.
- Added history card UI with 상세보기/리뷰 남기기 buttons, creator profile, place review summary, and reviewed-state disabled review CTA.
- Added profile review-write page (`/dashboard/profile/reviews`) with `PlainTopNav`, star rating(1~5), autosizing textarea(300자), and submit button flow.
- Added review actions `getAppointmentReviewTargetAction` and `submitPlaceReviewAction` with ended-appointment + participant/owner permission checks.
- Updated review flow to support both create and edit on the same page (`리뷰 남기기` / `리뷰 수정하기`), and switched submit action to upsert-like behavior (create-or-update).
- Added review-target query key/options (`appointmentKeys.reviewTarget`, `createAppointmentReviewTargetQueryOptions`).
- Updated history card review CTA: reviewed appointments now show `리뷰 수정하기` and navigate to the same review page for editing.
- Added migration `20260215173000_user_places_review_rls_policies.sql` to enable `user_places` RLS and allow authenticated self-only review insert/update/delete.
- Updated AI docs (`ACTIONS.md`, `FLOWS.md`) for the new history action/route.
- Switched `/dashboard/profile/reviews` to `내 리뷰` 목록 화면 (무한 스크롤 + 카드별 more 드롭다운).
- Added `/dashboard/profile/reviews/[appointmentId]` route as dedicated 리뷰 작성/수정 화면.
- Added `listMyReviewsAction` and `deleteMyReviewAction` for my-review list/delete flows.
- Updated history/review-waitlist review links to the new dynamic review editor route.
- Updated appointment invitation page top area to use shared `PlainTopNav` with title `그룹원 초대` and right action `완료`.
- Removed `/dashboard/appointments/invitation/complete` page; invitation `완료` now shows toast and returns directly to appointment detail.
- Updated appointment invitation search list to mark existing appointment members as disabled `약속 멤버` buttons.
- Improved appointment invitation error handling to map DB insert errors (`23505`, `42501`) and log details for debugging.
- Added `getPendingAppointmentInvitesAction` and wired invitation UI to render existing pending invitees as disabled `초대 완료` buttons.
- Added migration `20260215200000_invitations_select_group_member_policy.sql` to enable invitation select reads for group members.
- Removed debounce-based auto search on appointment invitation user search; search now runs only on explicit submit.
- Replaced split invitation status fetches with unified `getAppointmentInvitationStateAction` and moved invitation member/pending state ownership to React Query cache.
- Added profile comments page (`/dashboard/profile/comments`) with `PlainTopNav`, infinite-scroll card list, and per-card dropdown actions.
- Added `listMyCommentsAction` for cursor-based my-comment pagination and wired React Query (`appointmentKeys.myComments`).
- Added my-comment dropdown actions: `약속 상세 보기` deep-link and `댓글 삭제` with cache sync/invalidation.

## 2026-02-13
- Added profile group-management page (`/dashboard/profile/groups`) with shared `PlainTopNav`, card list UI, and infinite scroll.
- Added group-management card interactions: per-card `⋮` dropdown and real `그룹 탈퇴` action handling.
- Added `leaveGroupAction` and `listMyGroupsWithStatsAction`, plus group query key/options for management pagination.
- Added migration `20260213152000_group_manage_list_and_leave_policy.sql` for `list_my_groups_with_stats` RPC and `group_members_delete_self` policy.
- Added `getEffectiveAppointmentStatus` utility and applied derived `ended` status rendering for dashboard appointment cards.
- Updated appointment detail action UI to treat `ended`/`canceled` as non-participation states for non-owners (hide join/leave), preparing status simplification.
- Removed owner-side `확정하기/확정 취소` controls from appointment detail action area; now owner flow is `초대하기/취소하기` or `약속 활성화하기(취소 상태)`.
- Added server-side guards for appointment mutations: block `join/leave` on canceled or time-ended appointments, and block status changes on time-ended appointments.
- Replaced profile review waitlist dummy cards with real `listReviewableAppointmentsAction` data (ended + non-canceled appointments only) and linked each card to review entry route.
- Normalized appointment status exposure by collapsing persisted `confirmed` into `pending` at action/UI layer and removed `confirmed` badge/response typing from client-facing contracts.
- Added migration `20260213174000_remove_confirmed_from_appointment_status.sql` to normalize existing `confirmed` rows to `pending`, shrink `appointment_status` enum (`pending`,`canceled`), and recreate dependent appointment RPCs.
- Moved appointment cancel entry point from detail action area to appointment edit page (`약속 취소하기` button), while keeping detail page focused on invitation/activation controls.
- Moved `약속 활성화하기` entry point from detail page to appointment edit page, so both cancel/activate status transitions are handled in a single edit screen.
- Switched appointment edit status-button visibility source from local initial props to React Query detail cache (`appointmentKeys.detail`) to prevent stale status after cancel/activate round-trips.

## 2026-02-12
- Reworked `CACHE_OWNERSHIP.md` from high-level notes into a file-level ownership/invalidation matrix.
- Added explicit query-key standard, screen ownership table, mutation invalidation matrix, and operational checklist.
- Migrated appointment detail page to Query ownership with server prefetch + hydration (`AppointmentDetailClient`).
- Added detail/comment query keys (`appointmentKeys.detail`, `appointmentKeys.comments`) and matching query options.
- Removed `router.refresh()` calls from appointment detail status/join/leave actions and rely on query invalidation for sync.
- Updated appointment comment create/update/delete UI flow to sync `appointmentKeys.comments(...)` cache and invalidate `appointmentKeys.all` on count-changing mutations.
- Updated appointment edit completion flow to invalidate `appointmentKeys.all` and removed `router.refresh()` dependency.
- Added `appointmentKeys.listRoot/searchRoot` and `invalidateAppointmentQueries` helpers to avoid broad `appointmentKeys.all` invalidation.
- Narrowed detail/edit/comment invalidation to target detail/comments and collection roots instead of invalidating all appointment queries.
- Removed `revalidatePath` from `updateAppointmentStatusAction` to align with Query-owned synchronization.
- Removed comment-state duplication in `AppointmentCommentsSection` and switched it to direct Query subscription (`useQuery`) + cache updates via `setQueryData`.

## 2026-02-11
- Added `CACHE_OWNERSHIP.md` to document current Server/Client cache ownership and invalidation rules.
- Linked `CACHE_OWNERSHIP.md` from `INDEX.md` and referenced it in `DATA_STATE_STRATEGY.md`.
- Added owner-only comment menu UI (`⋮`) and dropdown actions (`댓글 수정`, `댓글 삭제`) on appointment detail comments.
- Added in-place comment edit flow (same input behavior as create: `Enter` submit, `Shift+Enter` newline, 200-char limit).
- Added `updateAppointmentCommentAction` and `deleteAppointmentCommentAction`.
- Added action tests: `updateAppointmentCommentAction.test.ts`, `deleteAppointmentCommentAction.test.ts`.
- Added `SUPABASE.md` for practical Supabase guardrails, checklists, and command-style prompts.
- Removed admin-client dependency from `getUserData` and switched users-table read to authenticated server client + RLS.
- Removed admin-client dependency from `updateProfileAction` and switched users-table update to authenticated server client + RLS.
- Removed admin-client dependency from `deleteProfileImageAction` and switched users/storage delete path to authenticated server client + RLS.
- Removed admin-client dependency from `uploadProfileImageAction` and switched users/storage upload path to authenticated server client + RLS.
- Removed admin-client dependency from `getAppointmentMembersAction` and switched member-list fetch to authenticated server client + RLS.
- Replaced admin-based email duplication check with RPC in `checkEmailExists` (`validation.ts`).
- Added `updateProfileAction.test.ts` with success/failure coverage for auth/user-row/auth-metadata update paths.
- Added `20260211201000_users_update_self_rls_policy.sql` migration (`users_update_self` policy + users update grant).
- Added `20260211203000_profile_images_storage_rls_policies.sql` migration for own-object access in `profile-images` bucket.
- Added `20260211210000_appointment_members_select_group_member.sql` migration to allow group members to read appointment member lists.
- Added `20260211213000_check_email_exists_rpc.sql` migration for pre-login email duplication checks.
- Updated appointment comment input to auto-resize textarea height on multiline input.
- Updated appointment comment UX: max length reduced to 200 chars, textarea input enabled, `Enter` submit and `Shift+Enter` line break behavior added.
- Added `appointment_comments` RLS migration (`20260211193000_appointment_comments_rls_policies.sql`).
- Switched comment read/write actions to authenticated client path (removed admin-client dependency for comments).
- Changed appointment comment permission from appointment-member-only to appointment-access-based (group member), allowing non-participant viewers to comment.
- Added appointment detail comment feature (list + create) in `/dashboard/appointments/[appointmentId]`.
- Added `getAppointmentCommentsAction` and `createAppointmentCommentAction`.
- Added comment input UI and comment card list (right-side dots button UI only).
- Added appointment edit submit flow for `/dashboard/appointments/[appointmentId]/edit`.
- Added editable title/date/time fields and connected `완료` button to real save.
- Added `updateAppointmentAction` with owner permission check and time validation.
- Added place resolution on edit save (existing `place_id` reuse or `kakao_id` upsert fallback).
- Added `updateAppointmentAction.test.ts` for invalid-time validation.
- Preserved edit draft query params (`title/date/startTime/endTime`) across place-search roundtrip.
- Included `placeKakaoId` in place-search selection query for update save compatibility.

## 2026-02-10
- Added appointment edit route `/dashboard/appointments/[appointmentId]/edit` UI with place-change CTA.
- Added appointment edit place-search route `/dashboard/appointments/[appointmentId]/edit/place` using create flow place search pattern.
- Added appointment members page at `/dashboard/appointments/[appointmentId]/members`.
- Added `getAppointmentMembersAction` and connected detail `멤버보기` button routing.
- Added appointment detail status actions (`확정`, `확정 취소`, `취소`, `활성화`) with toast feedback.
- Added `updateAppointmentStatusAction` and wired detail page CTA state rendering.
- Wired detail page `초대하기` button to appointment invitation page with query params.
- Added real dashboard search for groups/appointments by title with TanStack Query.
- Replaced search dummy data with server actions and cursor-based infinite scroll.
- Added `searchGroupsWithCountAction` and `searchAppointmentsByTitleAction`.
- Added Supabase RPC migration (`search_groups_with_count`, `search_appointments_with_count`) to return accurate member counts.
- Added query key/options for search and connected them to search result components.
- Added appointment detail page UI at `/dashboard/appointments/[appointmentId]` with detail top nav (`뒤로가기/수정`) and Kakao map preview.
- Added `getAppointmentDetailAction` and detail RPC (`get_appointment_detail_with_count`) for appointment/place/creator/member-count payload.

## 2026-02-06
- Moved dashboard route groups to `src/app/dashboard/(nav)` and `src/app/dashboard/(plain)`.
- Relocated nav components under `src/app/dashboard/_components/nav` and shared dashboard components under `src/app/dashboard/_components`.
- Removed legacy `(app)` and `(app-plain)` route groups.
- Reworked CODEMAP into a “start-here” navigation map and trimmed routes from it.
- Reorganized FLOWS to be the single source of route-to-file mappings.
- Added DESIGN_GUARDRAILS.md to centralize state/props/provider/query design rules.
- Linked AGENTS to the new guardrails doc.
- Refined DESIGN_GUARDRAILS.md into a decision checklist with query/provider/hydration guidance.
- Renamed DESIGN_GUARDRAILS.md to “Data Fetching & State Strategy” and expanded practical guardrails.
- Slimmed AGENTS.md to workflow + doc references and moved conventions into PROJECT.md.
- Standardized ERRORS_AND_LESSONS.md entries to a short template format.
- Updated DECISIONS.md to a short template and normalized the existing entry.
- Added a Korean decision entry for the dashboard route group restructure.
- Translated the existing DECISIONS.md entry into Korean for consistency.
- Added a workflow rule in AGENTS.md to record structural decisions in DECISIONS.md.
- Added CSS property order guidance to STYLE_GUIDE.md.
- Added practical CSS guidelines for layout-first, container responsibilities, and text overflow handling.
- Clarified DESIGN_SCAN.md wording for image usage, pixel scale, and file placement.
- Disabled Kakao map interaction in the appointment confirm step via a preview option.
- Added a horizontal `ReviewsWaitList` dummy card component to the profile page.
- Updated `ReviewsWaitList` cards to include appointment title and explicit rating count text.
- Added profile edit UI with image preview/upload, plus user profile update actions and DB migration for `users.profile_image`.
- Updated profile image upload flow to keep only the latest image by deleting the previous storage object after successful replacement.
- Changed profile data source to prefer `users` table in `getUserData` (metadata fallback kept).
- Adjusted profile image delete flow to update DB first, then remove storage file.
- Changed profile image metadata sync to best-effort in upload/delete actions.
- Improved profile edit submit flow to save text fields first, then apply image upload/delete.
- Added partial-success error messaging for profile image operations after text save.
- Fixed profile edit image control accessibility by removing nested button structure.
- Expanded `getUserData` tests to cover users-table-priority and metadata-fallback behavior.
- Added `uploadProfileImageAction`/`deleteProfileImageAction` tests for key edge cases (missing file, metadata sync failure, storage remove failure).
- Added profile-image URL parse-failure test cases for upload/delete actions.
- Split `src/actions/user.ts` into `src/actions/user/*` (index + per-action files + shared helpers/types).
- Split `src/actions/user.test.ts` into per-action test files under `src/actions/user/`.
- Split `src/actions/group.ts` into `src/actions/group/*` (index + per-action files + shared helpers/types) and removed the legacy single file.
- Split `src/actions/group.test.ts` into per-action test files under `src/actions/group/`.
- Added `src/actions/group/_testUtils.ts` and deduplicated repeated Supabase mock helpers across group action tests.
- Split `src/actions/appointment.ts` into `src/actions/appointment/*` (index + per-action files + shared helpers/types) and removed the legacy single file.
- Split `src/actions/appointment.test.ts` into `src/actions/appointment/createAppointmentAction.test.ts`.
- Split `src/actions/auth.ts` into `src/actions/auth/*` (index + per-action files + shared helpers/types) and removed the legacy single file.
- Split `src/actions/auth.test.ts` into per-action test files under `src/actions/auth/`.
- Centralized selected-group cookie read/write logic in `src/libs/server/groupSelectionCookie.ts` and made action/server readers reuse it.
- Consolidated `groupSelection` read/write into `src/libs/server/groupSelection.ts` and removed split helper/action files.

## 2026-02-04
- Added a sliding indicator animation to the search type toggle and aligned segments to equal widths.
- Documented DESIGN_SCAN.md usage in AGENTS.md and added it to the AI docs index.
- Added a search input component to the dashboard search page based on the design scan image.
- Removed mobile tap highlight and default button chrome from the search type toggle.
- Tuned the search toggle indicator transition to a springy cubic-bezier easing.
- Added appointment search result card/list components with dummy data for the search page.
- Added the missing appointment title line to the search result card.
- Added group search result card/list components with dummy data on the search page.
- Added a title line to the group search result cards.
- Wired the search type toggle to switch between appointment and group results via a client wrapper.
- Added TanStack Query provider and migrated the appointment list to useInfiniteQuery (client-only).
- Fixed React Query type errors and lint ordering warnings after the migration.
- Added SSR prefetch + HydrationBoundary for the dashboard appointment list.
-- Reverted server QueryClient util extraction (inlined again in dashboard page).
- Added shared appointment query keys utility for SSR/client consistency.
- Documented always considering type-check/lint in AGENTS.md and fixed query key typing.
- Extracted client QueryClient defaults into a utility and wired Providers to use it.
- Shared appointment list query options between SSR prefetch and client list.
- Added group query keys and group query options utilities.
- Switched dashboard group dropdown to useQuery and slimmed GroupProvider to selection state only.
- Prefetched group list data on the dashboard to hydrate the group dropdown.
- Switched create appointment flow to use group queries via the client component and synced provider state.
- Standardized create appointment step components to use `import * as styles` and documented the rule in STYLE_GUIDE.
- Refactored appointment creation to store draft data in provider and move step-specific state/handlers into each step.
- Migrated appointment create flow to react-hook-form with FormProvider/useFormContext and step-level validation.
- Centralized appointment schema usage by reusing `src/schemas/appointment.ts` in the create form types.
- Added Zod schema validation for appointment create form and wired zodResolver.
- Standardized dashboard css imports to `import * as styles` within `(app)/dashboard`.
- Inlined create-appointment group loading into the create page and removed the route layout wrapper.
- Renamed the appointment create client component to `MultiStepFormClient`.
- Split appointment create schema into a base schema and derived UI/server schemas.
- Moved time-order validation to UI-only schema and left server checks in action logic.
- Removed the duplicate PlaceStep next button to prevent skipping validation.
- Added loading/empty-state handling for group selection in the create flow.
- Limited ConfirmStep subscriptions to needed fields with useWatch.
- Added profile summary and quick-link components to the dashboard profile page.
- Set appointment create default date/time to now and +1 hour.
- Moved default date/time helper to `src/utils` and ensured DateTimeStep applies defaults.

## 2026-02-03
- Added dashboard appointment list with GroupContext for shared group selection state.
- Created `listAppointmentsAction` with cursor-based pagination, period/type filters.
- Added `useInfiniteScroll` hook with IntersectionObserver for infinite scroll.
- Created filter components: `PeriodFilter` (dropdown), `TypeFilter` (chip buttons).
- Created `AppointmentCard` with status badges (confirmed/pending/canceled), participant info, edit button.
- Created `AppointmentList` integrating filters, cards, and infinite scroll.
- Refactored `TopNav` to use `useGroupContext()` instead of props.
- Wrapped app layout children with `GroupProvider` for shared group state.
- Updated dashboard page to render `AppointmentList` component.
- Switched onboarding back button control to a route-based client gate and removed onboarding layout context usage.
- Converted onboarding group completion pages to Server Components using `searchParams` props.
- Split onboarding login into a Server page with a client `LoginForm` component to reduce `use client` scope.
- Split onboarding signup into a Server page with a client `SignupForm` component and moved root error styling to CSS.
- Split onboarding group create into a Server page with a client `GroupCreateForm` component.
- Split onboarding group invitation into a Server page with a client `GroupInvitationClient` for search/invite interactions.
- Split onboarding group join into a Server page with a client `GroupJoinClient` for search and navigation interactions.
- Split onboarding group join confirm into a Server page with a client `GroupJoinConfirmClient`, moving the join action to the client and resolving group name on the server when possible.
- Added `FormError` UI component and replaced the signup root error inline style with the shared component.
- Added `getActionErrorMessage` utility and adopted it across onboarding client actions for consistent error handling.
- Added group selection cookie actions to persist the selected group across navigations.
- Updated `GroupProvider` to persist selected group changes into cookies.
- Updated app layout to initialize group selection from the persisted cookie when available.
- Updated appointment create layout to initialize group selection from the persisted cookie when available.
- Guarded appointment creation to require a selected group.
- Moved cookie read helper to a server-only module to avoid client import issues.
- Removed group dropdown usage from `TopNav` in preparation for moving group selection to the dashboard page.
- Moved `GroupProvider` and group list initialization to the dashboard page.
- Added dashboard header with group dropdown for group selection.
- Added group selection step with a new dropdown in appointment create flow.
- Added new AI docs: DECISIONS, CODEMAP, ACTIONS, ERRORS_AND_LESSONS and registered them in INDEX.
- Removed outdated CONTEXT_SESSION.md and unlinked it from INDEX.
- Trimmed GROUP_FLOW.md to focus on routes, actions, and shared styles.
- Trimmed and updated APPOINTMENTS_FLOW.md to reflect current entry points and routes.
- Updated CONTEXT_ROUTES.md to match current route structure and appointment step locations.
- Merged CONTEXT_TROUBLESHOOTING.md into ERRORS_AND_LESSONS.md and removed the old file.
- Merged CONTEXT_ROUTES.md into CODEMAP.md and removed the standalone routes doc.
- Centralized action lists in ACTIONS.md and removed action sections from flow docs.
- Recorded recent decisions in DECISIONS.md (without impact/verification sections).
- Renamed context docs: PROJECT.md, GROUP_FLOW.md, APPOINTMENTS_FLOW.md, KAKAO_INTEGRATION.md, DB_RLS.md.
- Merged GROUP_FLOW.md and APPOINTMENTS_FLOW.md into FLOWS.md and removed the originals.
- Removed unused TEMPLATE.md and TEMPLATE_EN.md from ai_docs.
- Removed unused scripts/update_ai_docs.sh.
- Removed getActionErrorMessage utility and restored direct result handling.
- Split appointment create page into a Server page with a client AppointmentCreateClient.
- Extracted current location logic into `useCurrentLocation` hook for appointment creation.
- Extracted place search logic into `usePlaceSearch` hook for appointment creation.
- Moved group selection cookie helper to `src/libs/server` and updated imports.
- Added search page header toggle UI based on the design scan.
- Added active toggle state and transition animation for the search type switch.
- Split appointment invitation page into a Server page and a client `AppointmentInvitationClient`.
- Removed unused `comment_count` from `get_appointment_detail_with_count` RPC payload and aligned detail action typing to the new shape.
- Applied common action pattern (`parseOrFail`, `requireUser`, `actionError/actionSuccess`) across appointment actions for consistent validation/auth/response flow.
- Renamed `appointment` and `appointment/comment` action files to short verb-based filenames (removed `*Action` suffix) while preserving exported function names.
- Reorganized appointment actions into domain folders (`create`, `list`, `detail`, `member`, `comment`) and renamed shared contracts file from `_shared.ts` to `types.ts`.
- Added appointment search card navigation to detail page and updated card meta UI to show host profile image + member icon/count.
- Added migration to extend `search_appointments_with_count` RPC with `host_profile_image` and mapped it in appointment search action/types.
- Updated dashboard group search card UI to show owner profile image + member icon/count.
- Connected group search `가입하기` button to `joinGroupAction` with cache update/invalidation and toast feedback.
- Added migration to extend `search_groups_with_count` RPC with `owner_profile_image` and mapped it in group search action/types.
- Added shared `PlainTopNav` component and consolidated duplicated plain-route top nav variants (detail/edit/place/members) into wrappers using the shared component.
- Removed duplicated top nav style files from appointment plain routes after consolidation.
- Refactored `DetailPageTopNav` to wrap shared `PlainTopNav` and removed duplicated `DetailPageTopNav.css.ts`.
- Removed `DetailPageTopNav` wrapper and switched profile edit page to use `PlainTopNav` directly.

## 2026-02-02 (late)
- Moved appointment routes from `(app)` to `(app-plain)` for step-based flow layout.
- Updated CONTEXT_ROUTES.md to reflect new route structure.

## 2026-02-02
- Added group onboarding flow pages and server actions.
- Added group RLS migration and middleware group gate for dashboard.
- Added Kakao map loader/hook/preview and place search action.
- Added appointment create/invite flow pages and actions.
- Added shared docs and tests for new actions.
- Limited appointment place result list height with internal scroll and left-aligned result cards.
- Moved appointment place map preview below search area, outside result cards.
- Split appointment create steps into separate components for each step.
- Added current location permission flow and distance-based place search input support.
- Added RLS policies for places/appointments/appointment_members to allow appointment creation flows.
- Added server-side logging for appointment creation failures to surface place/appointment errors.
- Moved appointment create group fetch to server page and introduced a client wrapper component to avoid double POST in dev.
- Moved app layout group fetch to server and passed groups into TopNav to avoid duplicate POSTs.
- Added Kakao map SDK preload in app layout to reduce first-map load latency.
- Cleared Kakao map container on updates to prevent previous map layers from overlapping.
- Moved appointment create data fetch into a route layout with context and made the page the UI entry point.
- Reused the existing Moveback component for appointment step navigation.
- Split appointment create step styles into per-step .css.ts files and slimmed page.css.ts.
- Restored place map preview rendering inside the place step after refactors.
- Reverted Moveback changes and reused its existing styles for the create step back button.
- Fixed onboarding signup router hook to use next/navigation in App Router.
- Added AI styling rules doc for Vanilla Extract and layout conventions.
- Added rules-by-example section to the styling guide.
- Refreshed context docs for appointments, Kakao, routes, session notes, and troubleshooting.
- Added Kakao map preview to the appointment confirm step.

## 2026-02-02 (docs)
- Added CONTEXT_SESSION/DB_RLS/ROUTES/TROUBLESHOOTING.
- Added update helper script and refreshed INDEX entries.
